import aws from"@services/aws";import multer from"multer";import multerS3 from"multer-s3";let model;const fileFilter=(req,file,cb)=>{if(file.mimetype==="image/jpeg"||file.mimetype==="image/png"||file.mimetype==="image/gif"||file.mimetype==="image/webp"){cb(null,true)}else{cb(new Error("Invalid file type, Jpeg, Png, Gif, WebP allowed"),false)}};const upload=multer({fileFilter,storage:multerS3({acl:"public-read",s3:aws.s3,bucket:"spottables",metadata:function(req,file,cb){cb(null,{originalname:file.originalname.substr(0,255)})},key:function(req,file,cb){const json=JSON.parse(req.body.json);let prefix="";if(json.postId&&json.commentId){prefix="posts/"+json.postId+"/comments/"+json.commentId+"/"}else if(json.postId){prefix="posts/"+json.postId+"/comments/"+req.filename+"/"}else{prefix="posts/"+req.filename+"/"}cb(null,prefix+req.filename)}})});async function predictNsfw(imgUrl){return false}async function predictNsfwLambda(imgUrl){if(!imgUrl){return false}const params={FunctionName:"nsfw-image-prediction",Payload:JSON.stringify({image:imgUrl})};return aws.lambda.invoke(params).promise()}export default{upload,predictNsfw,predictNsfwLambda};
//# sourceMappingURL=image.js.map