<div class="container">
  <div
    class="reply"
    [ngClass]="{ linked: post.startCommentLink === reply.link }"
  >
    <div class="left-bar">
      <div class="left-bar-alignment">
        <div class="column">
          <i
            class="material-icons vote"
            (click)="like()"
            [ngClass]="{ highlight: reply.rated === 1 }"
          >
            keyboard_arrow_up
          </i>
          <div class="points">{{ reply.likes - reply.dislikes }}</div>
          <i
            class="material-icons vote"
            (click)="dislike()"
            [ngClass]="{ highlight: reply.rated === 0 }"
          >
            keyboard_arrow_down
          </i>
        </div>
        <div
          [class]="getProfilePictureClass(reply.profilePicture)"
          [ngClass]="{ 'profile-owned': reply.owned }"
        >
          <img
            [src]="
              '../../../../../assets/images/profile/' + reply.profilePictureSrc
            "
          />
        </div>
      </div>
    </div>
    <div class="add-wrapper">
      <div class="content">
        <div class="tagger" *ngIf="reply.tag.tagged">
          <span class="highlight"> {{ reply.tag.tagger }} </span>
          {{ 'MAIN.REPLY.TAGGER' | translate }}
        </div>

        <div class="text">
          <span #text class="text-content"></span>
          <span *ngIf="isExpandable">
            <span *ngIf="expanded; else notExpanded">
              <span class="expand" (click)="setExpanded(false)">
                {{ 'MAIN.REPLY.SEE_LESS' | translate }}
              </span>
            </span>
            <ng-template #notExpanded>
              <span class="expand" (click)="setExpanded(true)">
                {{ 'MAIN.REPLY.SEE_MORE' | translate }}
              </span>
            </ng-template>
          </span>
        </div>

        <div *ngIf="userMetadata$ | async as userMetadata">
          <div
            *ngIf="reply.image_src !== null"
            (click)="imageClicked()"
            class="image"
          >
            <img
              [src]="reply.image_src"
              [ngClass]="{
                'image-blur': imageBlurred && userMetadata.matureFilter
              }"
            />
            <div
              *ngIf="imageBlurred && userMetadata.matureFilter"
              class="image-blur-text"
            >
              <span class="material-icons icon"> error_outline </span>
              <span class="text">
                {{ 'MAIN.REPLY.MATURE_CONTENT' | translate }}
              </span>
              <span class="text highlight">
                {{ 'MAIN.REPLY.MATURE_CONTENT_SHOW' | translate }}
              </span>
            </div>
          </div>
        </div>
      </div>

      <div [hidden]="!showAddReply" class="add">
        <div class="editor">
          <span
            #reply2
            contenteditable="true"
            attr.ph="{{ 'MAIN.REPLY.ADD_REPLY_PLACEHOLDER' | translate }}"
            class="reply2-content"
            (input)="onTextInput($event)"
            (keydown.enter)="onEnter()"
          ></span>
          <div class="image" *ngIf="imgSrc !== null">
            <img [src]="domSanitizer.bypassSecurityTrustUrl(imgSrc)" />
          </div>
          <div class="file-options" *ngIf="imgSrc !== null">
            <span class="file-title">
              {{ 'MAIN.REPLY.FILE_TITLE' | translate }}
            </span>
            <span class="file-name">
              {{ getDisplayFilename(imageFile.name) }}
            </span>
            <span class="file-remove" (click)="removeFile()">
              <i class="material-icons"> delete </i>
            </span>
          </div>
          <div class="comment-options">
            <span
              class="counter"
              [ngClass]="{ 'counter-error': invalidLength() }"
            >
              {{ MAX_REPLY_LENGTH - currentLength }}
            </span>
            <input
              style="display: none"
              type="file"
              (change)="onFileChanged($event)"
              #fileInput
            />
            <i class="material-icons photo" (click)="fileInput.click()">
              insert_photo
            </i>
            <span class="loading" *ngIf="addReply2Loading; else showsend">
              <spot-spinner size="small" light="true"> </spot-spinner>
            </span>
            <ng-template #showsend>
              <span class="send" (click)="addReply()">
                <i class="material-icons"> send </i>
              </span>
            </ng-template>
          </div>
        </div>
      </div>
      <div class="error" *ngIf="addReply2Error">
        {{ addReply2Error }}
      </div>
    </div>
    <div class="right-bar">
      <div #options>
        <i class="material-icons icon-size" (click)="setOptions(true)">
          more_horiz
        </i>
        <div class="dropdown align-bottom">
          <div class="dropdown-content" [ngClass]="{ show: optionsEnabled }">
            <div
              class="button"
              (click)="openReportModal(reply.post_id, reply.id)"
            >
              <span class="material-icons icon"> outlined_flag </span>
              {{ 'MAIN.REPLY.REPORT' | translate }}
            </div>
            <div
              class="button"
              (click)="openShareModal(post.id, post.link, reply.id, reply.link)"
            >
              <span class="material-icons icon"> share </span>
              {{ 'MAIN.REPLY.SHARE' | translate }}
            </div>
            <div
              *ngIf="
                reply.owned ||
                user.role === 'ADMIN' ||
                user.role === 'OWNER'
              "
              class="button"
              (click)="deleteReply()"
            >
              <span class="material-icons icon"> delete </span>
              {{ 'MAIN.REPLY.DELETE' | translate }}
            </div>
          </div>
        </div>
      </div>
      <div class="time">
        {{ timeMessage }}
      </div>
      <div
        class="reply-icon"
        (click)="setShowAddReply(true)"
        [ngClass]="{
          disabled: !(
            comment.tag.tagged ||
            tagged ||
            (post.inRange &&
              (isAuthenticated$ | async) &&
              (isVerified$ | async) &&
              location)
          )
        }"
      >
        <i class="material-icons"> reply </i>
      </div>
    </div>
  </div>

  <span class="tag-relative" #tag>
    <spot-tag
      #tagelem
      *ngIf="showTag"
      [name]="tagName"
      [postLink]="post.link"
      (tag)="addTag($event)"
    ></spot-tag>
  </span>
</div>
