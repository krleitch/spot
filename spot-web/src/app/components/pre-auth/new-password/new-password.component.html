<spot-nav></spot-nav>
<div class="new-password">
  <div class="container">
    <div class="title">{{ 'PRE_AUTH.NEW_PASSWORD.TITLE' | translate }}</div>

    <div class="description">
      <i class="material-icons icon"> security </i>
      <div *ngIf="token; else validTokenDescription">
        <span class="text"> {{ 'PRE_AUTH.NEW_PASSWORD.CREATE_PASSWORD' | translate }} </span>
      </div>
      <ng-template #validTokenDescription>
        <span class="text"> {{ 'PRE_AUTH.NEW_PASSWORD.DESCRIPTION' | translate }} </span>
      </ng-template>
    </div>

    <div class="form-container" *ngIf="!token; else validToken">
      <form [formGroup]="formToken" (keyup.enter)="validateToken()">
        <div class="form-group">
          <input
            type="text"
            name="token"
            formControlName="token"
            placeholder="{{ 'PRE_AUTH.NEW_PASSWORD.TOKEN_PLACEHOLDER' | translate }}"
            required
          />
          <div *ngIf="tokenLoading" class="loading">
            <spot-spinner size="small"></spot-spinner>
          </div>
        </div>

        <div class="error-message">{{ errorMessage }}</div>

        <div class="success-message">{{ successMessage }}</div>

        <button
          (click)="validateToken()"
          [ngClass]="{ disabled: buttonsDisabled }"
        >
          {{ 'PRE_AUTH.NEW_PASSWORD.VALIDATE' | translate }}
        </button>
      </form>
    </div>

    <ng-template #validToken>
      <form [formGroup]="formPassword">
        <div class="form-group">
          <input
            type="text"
            name="password"
            formControlName="password"
            placeholder="{{ 'PRE_AUTH.NEW_PASSWORD.PASSWORD_PLACEHOLDER' | translate }}"
            type="password"
            required
          />
        </div>

        <div class="form-group">
          <input
            type="text"
            name="confirm"
            formControlName="confirm"
            placeholder="{{ 'PRE_AUTH.NEW_PASSWORD.CONFIRM_PLACEHOLDER' | translate }}"
            type="password"
            required
          />
        </div>

        <div class="error-message">{{ errorMessage }}</div>

        <div class="success-message">{{ successMessage }}</div>

        <button
          *ngIf="!successMessage"
          (click)="resetPassword()"
          [ngClass]="{ disabled: buttonsDisabled }"
        >
          {{ 'PRE_AUTH.NEW_PASSWORD.RESET_PASSWORD' | translate }}
        </button>
      </form>
    </ng-template>
  </div>
</div>
